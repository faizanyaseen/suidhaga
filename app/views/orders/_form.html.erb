<div class="card bg-base-100 shadow-xl">
  <div class="card-body">
    <%= form_with(model: @order, class: "mt-6", multipart: true) do |f| %>
      <% if @order.errors.any? %>
        <div class="alert alert-error mb-4">
          <div>
            <svg xmlns="http://www.w3.org/2000/svg" class="stroke-current flex-shrink-0 h-6 w-6" fill="none" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
            <div>
              <h2 class="font-medium">
                <%= pluralize(@order.errors.count, "error") %> prohibited this order from being saved:
              </h2>
              <ul class="mt-2 list-disc list-inside text-sm">
                <% @order.errors.full_messages.each do |message| %>
                  <li><%= message %></li>
                <% end %>
              </ul>
            </div>
          </div>
        </div>
      <% end %>
      
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div class="form-control">
          <%= f.label :customer_id, class: "label" %>
          <%= f.collection_select :customer_id, @customers, :id, ->(c) { "#{c.first_name} #{c.last_name}" },
              { prompt: "Select a customer" },
              { class: "select select-bordered w-full" } %>
        </div>
        
        <div class="form-control">
          <%= f.label :order_date, class: "label" %>
          <%= f.date_field :order_date, class: "input input-bordered w-full", placeholder: "Select date" %>
        </div>
      </div>
      
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
        <div class="form-control">
          <%= f.label :delivery_date, class: "label" %>
          <%= f.date_field :delivery_date, class: "input input-bordered w-full", placeholder: "Select date" %>
        </div>
        
        <div class="form-control">
          <%= f.label :status, class: "label" %>
          <%= f.select :status, Order.statuses.keys.map { |s| [s.humanize, s] },
              { prompt: "Select status" },
              { class: "select select-bordered w-full" } %>
        </div>
      </div>
      
      <div class="form-control mt-4">
        <%= f.label :notes, class: "label" %>
        <%= f.text_area :notes, class: "textarea textarea-bordered w-full", rows: 3, placeholder: "Enter order notes" %>
      </div>
      
      <!-- Line Items Section -->
      <div class="divider">Line Items</div>
      
      <div data-controller="nested-form" data-nested-form-wrapper-class-value="line-item-fields">
        <div class="flex justify-between items-center mb-4">
          <h3 class="text-lg font-medium">Items</h3>
          <button type="button"
                  data-action="nested-form#add"
                  class="btn btn-primary btn-sm">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
            </svg>
            Add Item
          </button>
        </div>
        
        <div class="space-y-6" data-nested-form-target="container">
          <%= f.fields_for :line_items do |line_item_form| %>
            <div class="line-item-fields p-4 border border-base-300 rounded-lg">
              <%= render 'line_item_fields', f: line_item_form %>
              
              <div class="flex justify-end mt-4">
                <button type="button"
                        data-action="nested-form#remove"
                        class="btn btn-error btn-sm">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                  </svg>
                  Remove Item
                </button>
              </div>
            </div>
          <% end %>
        </div>
        
        <template data-nested-form-target="template">
          <%= f.fields_for :line_items, LineItem.new, child_index: 'NEW_RECORD' do |line_item_form| %>
            <div class="line-item-fields p-4 border border-base-300 rounded-lg">
              <%= render 'line_item_fields', f: line_item_form %>
              
              <div class="flex justify-end mt-4">
                <button type="button"
                        data-action="nested-form#remove"
                        class="btn btn-error btn-sm">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                  </svg>
                  Remove Item
                </button>
              </div>
            </div>
          <% end %>
        </template>
      </div>
      
      <div class="form-control mt-6">
        <%= f.submit @order.new_record? ? "Create Order" : "Update Order", class: "btn btn-primary w-full" %>
      </div>
    <% end %>
  </div>
</div>